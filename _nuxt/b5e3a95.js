(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1598:function(e,t,n){"use strict";n.r(t);n(20),n(15),n(12),n(6),n(16);var o=n(37),r=(n(93),n(17)),c=n(2),d=n(87);function l(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h=n(13),v=h.Unit,f={data:function(){return{campaignId:void 0,dialog:!1,pledgeAmount:"",pledgeMessage:"",isConfirmLoading:!1,isRedeemed:!1,isDestroyed:!1,redeemLoopIterationsAfterDestroy:0}},computed:m(m({},Object(d.c)(["getDocumentById","getSumPledges","getIdentityId","getCampaignPledges","getRedemptionTxId","getUsernameByOwnerId","getLatestDocument"])),{},{campaign:function(){return this.getDocumentById(this.campaignId)||void 0},isPledgeAmountValid:function(){return!0===this.isNotPledgeAmountTooLarge()&&!0===this.isNotPledgeAmountTooSmall()}}),destroyed:function(){this.isDestroyed=!0},updated:function(){console.log("something updated",this.getSumPledges(this.campaignId),this.getRedemptionTxId(this.campaignId)),this.getSumPledges(this.campaignId)>=this.campaign.amount&&null===this.getRedemptionTxId(this.campaignId)&&(console.log("this project has enough backing, will redeem now:"),this.redeemTx({campaignId:this.campaignId}))},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.campaignId=e.$route.params.id,t.next=3,e.isClientReady();case 3:return t.next=5,e.fetchDocumentById({typeLocator:"springboard.campaign",docId:e.campaignId});case 5:void 0===t.sent&&(e.$router.push("/"),e.showSnackbar({text:"This project id does not exist."})),e.loopFetchNewPledges(),e.loopCheckPledges();case 9:case"end":return t.stop()}}),t)})))()},methods:m(m({},Object(d.b)(["fetchDocuments","fetchDocumentById","isClientReady","createPledgeUtxo","submitDocument","fetchPledges","redeemTx","fetchRedemptionState","showSnackbar","fetchL1UTXOSByAddress"])),{},{loopFetchNewPledges:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchDocuments({typeLocator:"springboard.pledge",queryOpts:{where:[["campaignId","==",e.campaignId],["$createdAt",">",e.getLatestDocument("pledge")]],orderBy:[["$createdAt","desc"]]}});case 2:case"end":return t.stop()}}),t)})))()},loopCheckPledges:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("campaign pledges",e.getCampaignPledges(e.campaignId)),n=0;case 2:if(!(n<e.getCampaignPledges(e.campaignId).length)){t.next=10;break}return t.next=5,e.fetchL1UTXOSByAddress(e.getCampaignPledges(e.campaignId)[n]._pledgeFromAddress);case 5:o=t.sent,console.log("checkPledges",o);case 7:n++,t.next=2;break;case 10:case"end":return t.stop()}}),t)})))()},DuffsinDash:function(e){return v.fromSatoshis(e).toBTC()},isNotPledgeAmountTooLarge:function(){var e=this.chooseMaxPledgeAmount(this.campaignId);return e?v.fromBTC(this.pledgeAmount).toSatoshis()<=v.fromBTC(e).toSatoshis()||"Amount too large":"Max Amount not available"},isNotPledgeAmountTooSmall:function(){var e=h.Unit.fromBTC(this.pledgeAmount).toSatoshis(),t=this.campaign.amount/16;return e<=0?"Be positive":e<500?"This is just dust":!(e<t)||"Min amount is ".concat(h.Unit.fromSatoshis(t).toBTC())},confirmPledge:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,c,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isConfirmLoading=!0,t.next=3,e.createPledgeUtxo({campaignRecipient:e.campaign.payoutAddress,campaignSatoshis:e.campaign.amount,pledgeSatoshis:v.fromBTC(e.pledgeAmount).toSatoshis()});case 3:return n=t.sent,r=Object(o.a)(n,2),c=r[0],d=r[1],l={campaignId:e.campaign.$id,message:e.pledgeMessage,utxo:c,tx:d},t.next=10,e.submitDocument({typeLocator:"springboard.pledge",doc:l});case 10:return t.next=12,e.fetchDocuments({typeLocator:"springboard.pledge",queryOpts:{where:[["campaignId","==",e.campaignId]],orderBy:[["$createdAt","desc"]]}});case 12:console.log("this.getSumPledges(this.campaignId) :>> ",e.getSumPledges(e.campaignId)),console.log("this.campaign.amount :>> ",e.campaign.amount),e.dialog=!1,e.isConfirmLoading=!1,e.pledgeMessage="",e.pledgeAmount="";case 18:case"end":return t.stop()}}),t)})))()},progressPledges:function(e){return parseInt(this.getSumPledges(e.$id))/parseInt(this.campaign.amount)*100},chooseMaxPledgeAmount:function(e){var t=v.fromBTC(this.$store.state.walletBalance).toSatoshis(),n=parseInt(this.campaign.amount)-this.getSumPledges(e.$id),o=t>n?n:t;return this.DuffsinDash(o)}})},x=n(94),_=n(117),y=n.n(_),I=n(1577),w=n(383),P=n(379),C=n(139),S=n(1572),A=n(1579),D=n(1578),T=n(382),k=n(1574),O=n(1592),B=n(1569),j=n(221),R=n(1570),V=n(1593),L=n(1594),component=Object(x.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.campaign?e._e():n("v-card",{staticClass:"mx-5 my-5"},[n("v-skeleton-loader",{attrs:{type:"card-heading, list-item-two-line"}})],1),e._v(" "),e.campaign?n("v-container",{staticStyle:{"max-width":"1000px"}},[e.getRedemptionTxId(e.campaignId)||e.getSumPledges(e.campaignId)>=e.campaign.amount?n("v-alert",{attrs:{color:"cyan",outlined:"",icon:"mdi-balloon"}},[n("strong",[e._v("Congratulations!")]),e._v(" This Project is successfully funded!\n    ")]):e._e(),e._v(" "),n("v-row",[n("v-col",[n("v-card",{staticClass:"mx-5 my-5",attrs:{elevation:"0","min-height":"155"}},[n("v-card-subtitle",{staticClass:"mb-0 py-0 px-0"},[e._v("\n            "+e._s(e.getUsernameByOwnerId(e.campaign.$ownerId))+"\n          ")]),e._v(" "),n("v-card-title",{staticClass:"pledged mt-0 pt-0 px-0"},[e._v("\n            "+e._s(e.campaign.title)+"\n          ")]),e._v(" "),n("v-card-text",{staticClass:"px-0",staticStyle:{"font-size":"20px","font-weight":"500px"},attrs:{"aria-autocomplete":"false\n            "}},[e._v("\n            "+e._s(e.campaign.description)+"\n          ")])],1)],1),e._v(" "),n("v-col",[n("v-progress-linear",{staticClass:"mt-5",attrs:{height:"18",color:"cyan",striped:"",value:e.progressPledges(e.campaign)}}),e._v(" "),n("div",[n("div",{staticClass:"pledgedtext"},[e._v("\n            backed\n            "),n("span",{staticClass:"pledged"},[e._v("\n              "+e._s(e.DuffsinDash(e.getSumPledges(e.campaignId)))+" Dash\n            ")])]),e._v(" "),n("div",{staticClass:"pledgedtext"},[e._v("\n            goal\n            "),n("span",{staticClass:"pledged"},[e._v("\n              "+e._s(e.DuffsinDash(e.campaign.amount))+" Dash\n            ")]),e._v(" "),n("span")]),e._v(" "),n("v-dialog",{attrs:{width:"500"},scopedSlots:e._u([{key:"activator",fn:function(t){var o=t.on,r=t.attrs;return[n("v-row",{attrs:{"no-gutters":""}},[e.getRedemptionTxId(e.campaignId)?e._e():n("v-btn",e._g(e._b({staticClass:"mt-2 mx-auto",attrs:{block:"",color:"#7B1FA2",dark:!!e.getIdentityId,disabled:!e.getIdentityId||e.getSumPledges(e.campaignId)>=e.campaign.amount}},"v-btn",r,!1),o),[e._v("\n                  Back this Project\n                ")]),e._v(" "),e.getRedemptionTxId(e.campaignId)||e.getSumPledges(e.campaignId)>=e.campaign.amount?n("v-btn",{staticClass:"pledgedtext",attrs:{disabled:!e.getRedemptionTxId(e.campaignId),block:"",color:"#00BCD4"}},[n("a",{staticStyle:{"text-decoration":"none",color:"white"},attrs:{href:"https://testnet-insight.dashevo.org/insight/tx/"+e.getRedemptionTxId(e.campaignId),target:"_blank"}},[e._v("View Transaction")])]):e._e()],1)]}}],null,!1,1865825390),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e._v(" "),n("v-card",{staticClass:"mx-auto",attrs:{"max-width":"600",align:"start"}},[n("v-card-title",[n("div",{staticClass:"pr-4 mb-4 pledgedtext"},[e._v("Back project")]),e._v(" "),n("div",{staticClass:"mb-4",staticStyle:{"font-size":"30px","font-weight":"bold",color:"purple"}},[e._v("\n                  "+e._s(e.campaign.title)+"\n                ")]),e._v(" "),n("v-text-field",{staticClass:"input_center",staticStyle:{"font-size":"35px"},attrs:{rules:[e.isNotPledgeAmountTooLarge(),e.isNotPledgeAmountTooSmall()],height:"55",color:"#00BCD4",placeholder:"1 Dash","aria-autocomplete":"false",autocomplete:"false",required:"",autofocus:""},model:{value:e.pledgeAmount,callback:function(t){e.pledgeAmount=t},expression:"pledgeAmount"}}),e._v(" "),n("v-btn",{staticClass:"mx-auto",staticStyle:{"font-size":"12px"},attrs:{text:"",link:"",color:"#7b1fa2",depressed:""},on:{click:function(t){e.pledgeAmount=e.chooseMaxPledgeAmount(e.campaign)}}},[e._v("\n                  Pledge Max Amount:\n                  "+e._s(e.chooseMaxPledgeAmount(e.campaign)+" Dash")+"\n                ")]),e._v(" "),n("v-card-text",{staticClass:"px-0"},[n("v-textarea",{staticClass:"mt-4 mx-auto",attrs:{"auto-grow":"",rows:"1","row-height":"12",color:"cyan",placeholder:"Add Optional Message"},model:{value:e.pledgeMessage,callback:function(t){e.pledgeMessage=t},expression:"pledgeMessage"}})],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{staticStyle:{color:"white"},attrs:{loading:e.isConfirmLoading,color:"#00BCD4",disabled:!e.isPledgeAmountValid&&e.chooseMaxPledgeAmount(e.campaign)>0},on:{click:e.confirmPledge}},[e._v("Back this Project")])],1)],1)],1)],1)],1)],1)],1):e._e(),e._v(" "),n("v-timeline",{staticStyle:{"max-width":"900px",margin:"auto"}},e._l(e.getCampaignPledges(e.campaignId).reverse(),(function(t,o){return n("v-timeline-item",{key:o,attrs:{small:"",color:"#00BCD4"}},[n("v-card",{staticClass:"elevation-2 pl-4 pr-4 pt-2",attrs:{"max-width":"400",shaped:""}},[n("div",{staticStyle:{"font-weight":"400","font-size":"18px"}},[n("span",{staticStyle:{color:"#7b1fa2","font-weight":"bold"}},[e._v("\n            "+e._s(e.getUsernameByOwnerId(t.$ownerId))+"\n          ")]),e._v("\n          backed\n          "),n("span",{staticStyle:{color:"#7b1fa2","font-weight":"bold"}},[e._v("\n            "+e._s(t._dash)+"\n          ")]),e._v("\n          Dash\n        ")]),e._v(" "),t.message?n("div",{staticStyle:{"font-style":"italic"}},[e._v('\n          "'+e._s(t.message)+'"\n        ')]):e._e(),e._v(" "),n("Timeago",{staticStyle:{color:"#787878","font-size":"15px"},attrs:{datetime:t.$createdAt}})],1)],1)})),1)],1)}),[],!1,null,null,null);t.default=component.exports;y()(component,{VAlert:I.a,VBtn:w.a,VCard:P.a,VCardActions:C.a,VCardSubtitle:C.b,VCardText:C.c,VCardTitle:C.d,VCol:S.a,VContainer:A.a,VDialog:D.a,VProgressLinear:T.a,VRow:k.a,VSkeletonLoader:O.a,VSpacer:B.a,VTextField:j.a,VTextarea:R.a,VTimeline:V.a,VTimelineItem:L.a})}}]);